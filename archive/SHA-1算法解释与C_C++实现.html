<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SHA-1算法解释与C/C++实现</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
	<a href="../index.html" style="position: fixed; top: 0; left: 2pt; text-align: center;text-decoration-line: none;color: black;font-size: 15px;">
		<img src="../img/home.png" width="15" height="15" alt="home">
		<span>HOME PAGE</span>
	  </a>
  <div class="stackedit__html"><h2><a id="SHA1_0"></a>SHA-1</h2>
<p>与MD5算法一样，也属于是一种哈希算法，并非是密码算法，也是因为其不可逆性，导致其在密码界常有应用，他与MD5的区别：</p>
<ul>
<li>输出定长为20字节</li>
<li>安全强度更强</li>
<li>算法计算过程略有不同</li>
</ul>
<h2><a id="_7"></a>算法实现过程</h2>
<ol>
<li>与其他哈希算法一样，首先肯定是对原文数据进行填充，输入不定长度的原文，要使其长度满足: “长度 mod 512bit =448bit”</li>
<li>不管其长度是否满足，都要在其后至少添加一个十进制数128即0x80，其二进制形式为1000 0000，如果长度不满足就在添加完0x80后继续填充0，一致填充到满足"长度 mod 512bit =448bit "为止</li>
<li>在添加完0x80后添加原文数据长度，记住原文数据长度要占八字节，最后记得初始化五组32bit的幻数，分别为：<code>A=0x67452301,B=0xefcdab89,C=0x98badcfe,D=0x10325476,E=0xc3d2e1f0</code>,可以看出比MD5算法多出了一个E</li>
<li>在进行完上述步骤后，不出错的话，此时填充后的数据长度刚好是512bit即64byte的倍数，然后开始每512bit一算</li>
<li>现在我们每组能获取一个64字节的数据，但是要注意SHA-1算法与MD5算法不同就在于，MD5算法是再将这64字节分为4组每组4个字节共16个字节共四轮运算，4*16最后将这64个字节处理完，而SHA-1则也是分为四组每组4个字节，一共四轮计算，但不同的是因为其输出长度固定为20字节，所以我们要将填充后的数据长度再进行处理，处理过程：</li>
</ol>
<pre><code class="prism language-cpp"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> i<span class="token punctuation">;</span>
		ulong_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>char_data<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span> <span class="token operator">|</span> 
						<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>char_data<span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span> <span class="token operator">|</span> 
						<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>char_data<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span> <span class="token operator">|</span>
						<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>char_data<span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">80</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		ulong_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> ulong_data<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">^</span> ulong_data<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">^</span> 
						ulong_data<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">^</span> ulong_data<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		ulong_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>ulong_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>ulong_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre>
<p>首先是将原本的64个字节的字符数据统一处理成一组四个字节的无符号整型数据，然后再在其后填充，一填充到满足80个无符号整形数据位置<br>
6. 现在处理就完成了，我们开始用80/20刚好得4组每组四个字节<br>
7. 然后将ABCDE五组幻数进行移动，D-&gt;E,C-&gt;E，然后对C进行计算处理，A-&gt;B然后对A进行计算处理，一次循环计算<br>
8. 最终将每轮计算的ABCDE相加得出最后结果</p>
<h2><a id="_39"></a>代码实现</h2>
<p>首先初始化一下我们要使用到的一些常量比如五组幻数：</p>
<pre><code class="prism language-cpp">	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> f <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> temp_ul_text<span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> temp_A <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> h<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0x67452301</span><span class="token punctuation">,</span><span class="token number">0xefcdab89</span><span class="token punctuation">,</span><span class="token number">0x98badcfe</span><span class="token punctuation">,</span><span class="token number">0x10325476</span><span class="token punctuation">,</span><span class="token number">0xc3d2e1f0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>然后开始填充原数据</p>
<pre><code class="prism language-cpp"><span class="token comment">/*
	*开始填充原文
	*/</span>
	size_t n_len <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">64</span> <span class="token operator">+</span> <span class="token number">56</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span>n_text <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>n_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span>n_text<span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> n_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">memcpy</span><span class="token punctuation">(</span>n_text<span class="token punctuation">,</span> text<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	n_text<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> c_lens<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span>c_lens<span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> temp_len <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>len <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">memcpy</span><span class="token punctuation">(</span>c_lens<span class="token punctuation">,</span> <span class="token operator">&amp;</span>temp_len<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">/*
	*颠倒数据长度存储的端序
	*/</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">int</span> y <span class="token operator">=</span> c_lens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		c_lens<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> c_lens<span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">-</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		c_lens<span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">-</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> y<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">memcpy</span><span class="token punctuation">(</span>n_text <span class="token operator">+</span> <span class="token punctuation">(</span>n_len <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c_lens<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>这里要注意要将长度位置颠倒一下，把第一个字节放到最后一个，第二个放到倒二…以此类推，我不知道为什么SHA-1算法必须要这样处理，而MD5不需要，但经过我的测试，如果SHA-1不这么做最后结果是错误的</p>
<p>现在开始64字节一组开始计算</p>
<pre><code class="prism language-cpp"><span class="token comment">/*
	*分组计算，512bits一组
	*/</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n_len<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">64</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//A=H[0],B=H[1],C=H[2],D=H[3],E=H[4]</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">int</span> H<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">char</span> temp_text<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

		<span class="token function">memset</span><span class="token punctuation">(</span>temp_text<span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">memset</span><span class="token punctuation">(</span>temp_ul_text<span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">memcpy</span><span class="token punctuation">(</span>H<span class="token punctuation">,</span> h<span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">memcpy</span><span class="token punctuation">(</span>temp_text<span class="token punctuation">,</span> <span class="token punctuation">(</span>n_text <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">CharToUlong</span><span class="token punctuation">(</span>temp_text<span class="token punctuation">,</span> temp_ul_text<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">80</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>j<span class="token operator">/</span><span class="token number">20</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
			<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
				k <span class="token operator">=</span> <span class="token number">0x5a827999</span><span class="token punctuation">;</span>
				f <span class="token operator">=</span> <span class="token punctuation">(</span>H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> H<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> H<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
				k <span class="token operator">=</span> <span class="token number">0x6ed9eba1</span><span class="token punctuation">;</span>
				f <span class="token operator">=</span> H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> H<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span> H<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
				k <span class="token operator">=</span> <span class="token number">0x8f1bbcdc</span><span class="token punctuation">;</span>
				f <span class="token operator">=</span> <span class="token punctuation">(</span>H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> H<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> H<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>H<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> H<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
				k <span class="token operator">=</span> <span class="token number">0xca62c1d6</span><span class="token punctuation">;</span>
				f <span class="token operator">=</span> H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> H<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span> H<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">default</span><span class="token operator">:</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">//ABCDE位置移动</span>
			temp_A <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>H<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>H<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> f <span class="token operator">+</span> H<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span> temp_ul_text<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> k<span class="token punctuation">;</span>
			H<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> H<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			H<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> H<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			H<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> H<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			H<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp_A<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//ABCDE累加</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>
			h<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">+=</span> H<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre>
<p>在这里还有一个CharToUlong函数，他的实现为：</p>
<pre><code class="prism language-cpp"><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token class-name">SHA1</span><span class="token double-colon punctuation">::</span><span class="token function">CharToUlong</span>
<span class="token punctuation">(</span>
	_In_ <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> char_data<span class="token punctuation">,</span>
	_Inout_ <span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">*</span> ulong_data
<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> i<span class="token punctuation">;</span>
		ulong_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>char_data<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span> <span class="token operator">|</span> 
						<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>char_data<span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span> <span class="token operator">|</span> 
						<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>char_data<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span> <span class="token operator">|</span>
						<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>char_data<span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">80</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		ulong_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> ulong_data<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">^</span> ulong_data<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">^</span> 
						ulong_data<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">^</span> ulong_data<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		ulong_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>ulong_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>ulong_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>最后将我们之前申请的内存释放，并将结果转换为字符串即可</p>
<pre><code class="prism language-cpp"><span class="token function">free</span><span class="token punctuation">(</span>n_text<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//字符串格式化返回输出结果</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> o <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> o <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> o<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">sprintf_s</span><span class="token punctuation">(</span>outData<span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token string">"%08x"</span><span class="token punctuation">,</span> h<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		outData <span class="token operator">+=</span> <span class="token number">8</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	outData<span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
</code></pre>
</div>
</body>

</html>
