<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C++ 实现Base64编码</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h2><a id="Base64_0"></a>Base64编码</h2>
<p>是网络上最常见的用于传输8Bit字节码的编码方式之一，Base64就是一种基于64个可打印字符来表示二进制数据的方法,Base64编码是从二进制到字符的过程，可用于在HTTP环境下传递较长的标识信息。采用Base64编码具有不可读性，需要解码后才能阅读。</p>
<p><strong>编码实现过程</strong><br>
想要实现对字符串的base64编码，首先肯定要知道它的编码过程，在进行编码前首先要设置码表</p>
<pre><code class="prism language-cpp"><span class="token keyword">const</span> u_char base64tab<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span>
<span class="token punctuation">{</span>
 <span class="token char">'A'</span><span class="token punctuation">,</span><span class="token char">'B'</span><span class="token punctuation">,</span><span class="token char">'C'</span><span class="token punctuation">,</span><span class="token char">'D'</span> <span class="token punctuation">,</span> <span class="token char">'E'</span><span class="token punctuation">,</span><span class="token char">'F'</span><span class="token punctuation">,</span><span class="token char">'G'</span><span class="token punctuation">,</span><span class="token char">'H'</span><span class="token punctuation">,</span>
 <span class="token char">'I'</span><span class="token punctuation">,</span><span class="token char">'J'</span><span class="token punctuation">,</span><span class="token char">'K'</span><span class="token punctuation">,</span><span class="token char">'L'</span> <span class="token punctuation">,</span> <span class="token char">'M'</span><span class="token punctuation">,</span><span class="token char">'N'</span><span class="token punctuation">,</span><span class="token char">'O'</span><span class="token punctuation">,</span><span class="token char">'P'</span><span class="token punctuation">,</span>
 <span class="token char">'Q'</span><span class="token punctuation">,</span><span class="token char">'R'</span><span class="token punctuation">,</span><span class="token char">'S'</span><span class="token punctuation">,</span><span class="token char">'T'</span> <span class="token punctuation">,</span> <span class="token char">'U'</span><span class="token punctuation">,</span><span class="token char">'V'</span><span class="token punctuation">,</span><span class="token char">'W'</span><span class="token punctuation">,</span><span class="token char">'X'</span><span class="token punctuation">,</span>
 <span class="token char">'Y'</span><span class="token punctuation">,</span><span class="token char">'Z'</span><span class="token punctuation">,</span><span class="token char">'a'</span><span class="token punctuation">,</span><span class="token char">'b'</span> <span class="token punctuation">,</span> <span class="token char">'c'</span><span class="token punctuation">,</span><span class="token char">'d'</span><span class="token punctuation">,</span><span class="token char">'e'</span><span class="token punctuation">,</span><span class="token char">'f'</span><span class="token punctuation">,</span>
 <span class="token char">'g'</span><span class="token punctuation">,</span><span class="token char">'h'</span><span class="token punctuation">,</span><span class="token char">'i'</span><span class="token punctuation">,</span><span class="token char">'j'</span> <span class="token punctuation">,</span> <span class="token char">'k'</span><span class="token punctuation">,</span><span class="token char">'l'</span><span class="token punctuation">,</span><span class="token char">'m'</span><span class="token punctuation">,</span><span class="token char">'n'</span><span class="token punctuation">,</span>
 <span class="token char">'o'</span><span class="token punctuation">,</span><span class="token char">'p'</span><span class="token punctuation">,</span><span class="token char">'q'</span><span class="token punctuation">,</span><span class="token char">'r'</span> <span class="token punctuation">,</span> <span class="token char">'s'</span><span class="token punctuation">,</span><span class="token char">'t'</span><span class="token punctuation">,</span><span class="token char">'u'</span><span class="token punctuation">,</span><span class="token char">'v'</span><span class="token punctuation">,</span>
 <span class="token char">'w'</span><span class="token punctuation">,</span><span class="token char">'x'</span><span class="token punctuation">,</span><span class="token char">'y'</span><span class="token punctuation">,</span><span class="token char">'z'</span> <span class="token punctuation">,</span> <span class="token char">'0'</span><span class="token punctuation">,</span><span class="token char">'1'</span><span class="token punctuation">,</span><span class="token char">'2'</span><span class="token punctuation">,</span><span class="token char">'3'</span><span class="token punctuation">,</span>
 <span class="token char">'4'</span><span class="token punctuation">,</span><span class="token char">'5'</span><span class="token punctuation">,</span><span class="token char">'6'</span><span class="token punctuation">,</span><span class="token char">'7'</span> <span class="token punctuation">,</span> <span class="token char">'8'</span><span class="token punctuation">,</span><span class="token char">'9'</span><span class="token punctuation">,</span><span class="token char">'+'</span><span class="token punctuation">,</span><span class="token char">'/'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre>
<p>可以看出它的码表一共有64个字符，现在就能理解他为什么叫base64了，有了编码的对照码表，我们现在就可以深究它的编码计算过程了，首先假设我们现在有一个明文字符串<code>"ABC"</code>那按照base64的标准，该如何进行编码呢？首先我们知道在这串字符串中一个字符占一个字节，一共三个字节，每个字节八位，一共是三组八位共24位二进制数，现在我们需要吧这24位二进制数拆成每组六个字节，一共4组的一串数据就像这样<br>
<img src="https://img-blog.csdnimg.cn/20200325183133922.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzgxNTkzMA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">这样一来就把明文的二进制码拆开了，拆开后是六位二进制数，要放入内存必须要一个字节才行，那就再每个六位二进制数前面加两个0刚好凑够一个字节</p>
<p>现在还有一共问题，那就是三个字节的字符串刚好可以拆成四组，那不是三个字节的字符串，或字符个数不是三的倍数的字符串怎么编码呢？当然也有办法，如果有一个字符串一共长12个字节，那我们分成四组三个字节的短字符串，按组来处理就好了。那假如是一个13个字节的字符串呢，13不是3的倍数，那又该怎么分组呢，首先3的倍数基本上是每隔两个数就会出现一次，那就先按12来算，可以分成四组，最后一组不足三个字节，如果剩余一个字符，那就补两个<code>“==”</code>字符串，同样的假如剩余两个字符那就补一个<code>“=”</code><br>
如图所示<br>
<img src="https://img-blog.csdnimg.cn/20200325184857189.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzgxNTkzMA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述">假设是字符串“ABCE"编码过程大致就是这样，同样也是分为每组6个后方便存入内存，在高位补两位0。</p>
<p>在这里我们新转换到的数字并不是base64密文的ascii码，这里获取到的数字是一个索引下标，没错就是我们刚刚设置的那个有64个字符的base64编码表的下标，我们根据算出的小标就能找到密文对应的字符，再将这些字符存入字符串就得到了一串base64编码的字符串，要注意的是最后一组如果不够三个字节，补上去的两个或一个<code>“=”</code>不参与编码位运算</p>
<p><strong>代码实现</strong><br>
首先在C++中最小的存储单位是字节，所以我们无法直接将每一位拆开重组，那如何将字节中的每一位拆分重组呢？没错就是位移运算</p>
<pre><code class="prism language-cpp">string <span class="token class-name">Base64</span><span class="token double-colon punctuation">::</span><span class="token function">Base64Encode</span>
<span class="token punctuation">(</span>
	_In_ string tsrc<span class="token punctuation">,</span>
	_In_ u_long srcsize 
<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">const</span> u_char<span class="token operator">*</span> src <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> u_char<span class="token operator">*</span><span class="token punctuation">)</span>tsrc<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	u_char<span class="token operator">*</span> tempBuff <span class="token operator">=</span> <span class="token keyword">new</span> u_char<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	string destStr<span class="token punctuation">;</span>
	<span class="token comment">//取到最后剩几个数据</span>
	<span class="token keyword">int</span> lastNumb <span class="token operator">=</span> srcsize <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>

	<span class="token comment">//分为三组处理</span>
	<span class="token keyword">int</span> i<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>srcsize <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">memset</span><span class="token punctuation">(</span>tempBuff<span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">memcpy</span><span class="token punctuation">(</span>tempBuff<span class="token punctuation">,</span> <span class="token punctuation">(</span>src<span class="token operator">+</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		destStr <span class="token operator">+=</span> base64tab<span class="token punctuation">[</span><span class="token punctuation">(</span>tempBuff<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		destStr <span class="token operator">+=</span> base64tab<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>tempBuff<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x03</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>tempBuff<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		destStr <span class="token operator">+=</span> base64tab<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>tempBuff<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>tempBuff<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		destStr <span class="token operator">+=</span> base64tab<span class="token punctuation">[</span><span class="token punctuation">(</span>tempBuff<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//剩余不够一组的数据处理</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>lastNumb <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">memset</span><span class="token punctuation">(</span>tempBuff<span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">memcpy</span><span class="token punctuation">(</span>tempBuff<span class="token punctuation">,</span> <span class="token punctuation">(</span>src <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		destStr <span class="token operator">+=</span> base64tab<span class="token punctuation">[</span><span class="token punctuation">(</span>tempBuff<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		destStr <span class="token operator">+=</span> base64tab<span class="token punctuation">[</span><span class="token punctuation">(</span>tempBuff<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x03</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		destStr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"=="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>lastNumb <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">memset</span><span class="token punctuation">(</span>tempBuff<span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">memcpy</span><span class="token punctuation">(</span>tempBuff<span class="token punctuation">,</span> <span class="token punctuation">(</span>src <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		destStr <span class="token operator">+=</span> base64tab<span class="token punctuation">[</span><span class="token punctuation">(</span>tempBuff<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		destStr <span class="token operator">+=</span> base64tab<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>tempBuff<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x03</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>tempBuff<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		destStr <span class="token operator">+=</span> base64tab<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>tempBuff<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x0f</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		destStr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token comment">//释放内存</span>
	<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tempBuff<span class="token punctuation">;</span>
	<span class="token keyword">return</span> destStr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>z我这里实现了一个base64编解码的类，在类中实现了一个静态函数，完整项目代码已上传github，地址在最后<br>
对于解码，就是对编码的逆运算，没有什么好说的，<br>
可以参考这篇文章，个人感觉解码效率还挺高<br>
<a href="https://blog.csdn.net/FlushHip/article/details/82498670">Base64编解码及其C++实现 原创</a><br>
这种方法感觉效率很高，可以参考</p>
<p>完整项目地址github：<br>
<a href="https://github.com/usb1565203609/CppFastSolution-/tree/master/sources">CppFastSolution</a></p>
</div>
</body>

</html>
