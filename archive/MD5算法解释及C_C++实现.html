<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MD5算法解释及C/C++实现</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h2><a id="MD5_0"></a>关于MD5</h2>
<p>MD5是由Ronald Linn Rivest设计，于1992年公开，用以取代MD4算法的一种散列算法，首先要明确的是，他本身并非是一种加密算法，但因为其不可逆性，导致在密码界也常有应用，因为不可逆性，曾一度被认为是一种比较安全的算法，但据说被我天朝山东大学的一位女教授给破解了，只用几个小时就可以将其碰撞（就是用不同的明文算出相同的密文，姑且这样形容…），所以就目前而言，已经不再是一种百分之百安全的算法了（跟md5出自同宗的SHA-1算法据说也被谷歌给破了…）</p>
<h2><a id="_3"></a>算法过程</h2>
<p>MD5算法的过程，总体简述就是，输入一个不定长度的数据，经过填充按照64字节一组分别进行计算，最后输出一个定长128its的数据。<br>
详细过程：</p>
<ol>
<li>首先输入一串不定长度的数据，用其长度除以512余数要为448，如果不够则在其后填充一个二进制的1和若干二进制0</li>
<li>将输入的原数据长度填充到最后，注意一定要站8个字节，也就是64bit</li>
<li>将填充完毕的数据，每64字节即512bit为一组进行计算(如果不出错的话，填充后的数据长度刚好是64字节的倍数），然后每组计算过程中，又需要一个128bit的缓存器来存储计算的结果，可以将这个缓存器分为4组32bit的幻数A、B、C、D，将其分别初始化为：<br>
A ： 01 23 45 67<br>
B： 89 ab cd ef<br>
C： fe dc ba 98<br>
D： 76 54 32 10<br>
然后要注意大小端序的问题所以应该写成：67452301、efcdab89、98badcfe、10325476</li>
<li>然后将之前分好的512bit一组再分为4组，每组4个字节共16字节128bit，如何在进行4轮计算，刚好把这512bit即64字节处理完</li>
<li>还需要四个非线性函数F、G、H、I，对输入进行处理计算<br>
F(X,Y,Z)=(X&amp;Y)|((~X)&amp;Z)<br>
G(X,Y,Z)=(X&amp;Z)|(Y&amp;(~Z))<br>
H(X,Y,Z)=X^Y ^Z<br>
I(X,Y,Z)=Y^(X|(~Z))</li>
<li>然后开始4论计算，首先说明每组计算过程：</li>
</ol>
<pre><code class="prism language-cpp">	<span class="token function">FF</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>Mj<span class="token punctuation">,</span>s<span class="token punctuation">,</span>ti<span class="token punctuation">)</span>表示a<span class="token operator">=</span>b<span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">+</span><span class="token function">F</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span><span class="token operator">+</span>Mj<span class="token operator">+</span>ti<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>s<span class="token punctuation">)</span>
	<span class="token function">GG</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>Mj<span class="token punctuation">,</span>s<span class="token punctuation">,</span>ti<span class="token punctuation">)</span>表示a<span class="token operator">=</span>b<span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">+</span><span class="token function">G</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span><span class="token operator">+</span>Mj<span class="token operator">+</span>ti<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>s<span class="token punctuation">)</span>
	<span class="token function">HH</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>Mj<span class="token punctuation">,</span>s<span class="token punctuation">,</span>ti<span class="token punctuation">)</span>表示a<span class="token operator">=</span>b<span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">+</span><span class="token function">H</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span><span class="token operator">+</span>Mj<span class="token operator">+</span>ti<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>s<span class="token punctuation">)</span>
	<span class="token function">II</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>Mj<span class="token punctuation">,</span>s<span class="token punctuation">,</span>ti<span class="token punctuation">)</span>表示a<span class="token operator">=</span>b<span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">+</span><span class="token function">I</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span><span class="token operator">+</span>Mj<span class="token operator">+</span>ti<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>s<span class="token punctuation">)</span>
</code></pre>
<pre><code>然后开始
</code></pre>
<pre><code class="prism language-c">第一轮
a<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M0<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0xd76aa478</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M1<span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">0xe8c7b756</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M2<span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">0x242070db</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M3<span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">0xc1bdceee</span><span class="token punctuation">)</span>
a<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M4<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0xf57c0faf</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M5<span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">0x4787c62a</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M6<span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">0xa8304613</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M7<span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">0xfd469501</span><span class="token punctuation">)</span>
a<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M8<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0x698098d8</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M9<span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">0x8b44f7af</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M10<span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">0xffff5bb1</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M11<span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">0x895cd7be</span><span class="token punctuation">)</span>
a<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M12<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0x6b901122</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M13<span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">0xfd987193</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M14<span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">0xa679438e</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">FF</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M15<span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">0x49b40821</span><span class="token punctuation">)</span>

第二轮
a<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M1<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0xf61e2562</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M6<span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">0xc040b340</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M11<span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x265e5a51</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M0<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0xe9b6c7aa</span><span class="token punctuation">)</span>
a<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M5<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0xd62f105d</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M10<span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">0x02441453</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M15<span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0xd8a1e681</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M4<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0xe7d3fbc8</span><span class="token punctuation">)</span>
a<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M9<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0x21e1cde6</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M14<span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">0xc33707d6</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M3<span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0xf4d50d87</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M8<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0x455a14ed</span><span class="token punctuation">)</span>
a<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M13<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0xa9e3e905</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M2<span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">0xfcefa3f8</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M7<span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x676f02d9</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">GG</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M12<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0x8d2a4c8a</span><span class="token punctuation">)</span>

第三轮
a<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M5<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0xfffa3942</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M8<span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">0x8771f681</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M11<span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">0x6d9d6122</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M14<span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">0xfde5380c</span><span class="token punctuation">)</span>
a<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M1<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0xa4beea44</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M4<span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">0x4bdecfa9</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M7<span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">0xf6bb4b60</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M10<span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">0xbebfbc70</span><span class="token punctuation">)</span>
a<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M13<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0x289b7ec6</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M0<span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">0xeaa127fa</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M3<span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">0xd4ef3085</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M6<span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">0x04881d05</span><span class="token punctuation">)</span>
a<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M9<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0xd9d4d039</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M12<span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">0xe6db99e5</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M15<span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">0x1fa27cf8</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">HH</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M2<span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token number">0xc4ac5665</span><span class="token punctuation">)</span>

第四轮
a<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M0<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0xf4292244</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M7<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0x432aff97</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M14<span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">0xab9423a7</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M5<span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">0xfc93a039</span><span class="token punctuation">)</span>
a<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M12<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0x655b59c3</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M3<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0x8f0ccc92</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M10<span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">0xffeff47d</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M1<span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">0x85845dd1</span><span class="token punctuation">)</span>
a<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M8<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0x6fa87e4f</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M15<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0xfe2ce6e0</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M6<span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">0xa3014314</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M13<span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">0x4e0811a1</span><span class="token punctuation">)</span>
a<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>M4<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0xf7537e82</span><span class="token punctuation">)</span>
b<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>M11<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0xbd3af235</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>M2<span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">0x2ad7d2bb</span><span class="token punctuation">)</span>
d<span class="token operator">=</span><span class="token function">II</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>M9<span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">0xeb86d391</span><span class="token punctuation">)</span>
</code></pre>
<ol start="7">
<li>最后记得每组计算完毕后ABCD分别要与abcd相加，然后进入下一组512bit的计算</li>
</ol>
<p><strong>最后要说明的一点是，如果原数据长度超过或达到了56个字节，就要将其长度补齐为64，不然无法计算56以及超过56字节的数据</strong></p>
<p>然后上代码<br>
首先初始化一些需要的必要数据以及变量缓存区：</p>
<pre><code class="prism language-cpp"><span class="token comment">//用于存放最终结果，以便转化为字符串</span>
	<span class="token keyword">short</span> output<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> dest<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> SHORT_MD5_LEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> CHAR_MD5_LEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//四组幻数</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> h<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0x67452301</span><span class="token punctuation">,</span> <span class="token number">0xefcdab89</span><span class="token punctuation">,</span> <span class="token number">0x98badcfe</span><span class="token punctuation">,</span> <span class="token number">0x10325476</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> k<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span>
	<span class="token punctuation">{</span>
		<span class="token number">0xd76aa478</span><span class="token punctuation">,</span> <span class="token number">0xe8c7b756</span><span class="token punctuation">,</span> <span class="token number">0x242070db</span><span class="token punctuation">,</span> <span class="token number">0xc1bdceee</span><span class="token punctuation">,</span>
		<span class="token number">0xf57c0faf</span><span class="token punctuation">,</span> <span class="token number">0x4787c62a</span><span class="token punctuation">,</span> <span class="token number">0xa8304613</span><span class="token punctuation">,</span> <span class="token number">0xfd469501</span><span class="token punctuation">,</span>
		<span class="token number">0x698098d8</span><span class="token punctuation">,</span> <span class="token number">0x8b44f7af</span><span class="token punctuation">,</span> <span class="token number">0xffff5bb1</span><span class="token punctuation">,</span> <span class="token number">0x895cd7be</span><span class="token punctuation">,</span>
		<span class="token number">0x6b901122</span><span class="token punctuation">,</span> <span class="token number">0xfd987193</span><span class="token punctuation">,</span> <span class="token number">0xa679438e</span><span class="token punctuation">,</span> <span class="token number">0x49b40821</span><span class="token punctuation">,</span>
		<span class="token number">0xf61e2562</span><span class="token punctuation">,</span> <span class="token number">0xc040b340</span><span class="token punctuation">,</span> <span class="token number">0x265e5a51</span><span class="token punctuation">,</span> <span class="token number">0xe9b6c7aa</span><span class="token punctuation">,</span>
		<span class="token number">0xd62f105d</span><span class="token punctuation">,</span> <span class="token number">0x02441453</span><span class="token punctuation">,</span> <span class="token number">0xd8a1e681</span><span class="token punctuation">,</span> <span class="token number">0xe7d3fbc8</span><span class="token punctuation">,</span>
		<span class="token number">0x21e1cde6</span><span class="token punctuation">,</span> <span class="token number">0xc33707d6</span><span class="token punctuation">,</span> <span class="token number">0xf4d50d87</span><span class="token punctuation">,</span> <span class="token number">0x455a14ed</span><span class="token punctuation">,</span>
		<span class="token number">0xa9e3e905</span><span class="token punctuation">,</span> <span class="token number">0xfcefa3f8</span><span class="token punctuation">,</span> <span class="token number">0x676f02d9</span><span class="token punctuation">,</span> <span class="token number">0x8d2a4c8a</span><span class="token punctuation">,</span>
		<span class="token number">0xfffa3942</span><span class="token punctuation">,</span> <span class="token number">0x8771f681</span><span class="token punctuation">,</span> <span class="token number">0x6d9d6122</span><span class="token punctuation">,</span> <span class="token number">0xfde5380c</span><span class="token punctuation">,</span>
		<span class="token number">0xa4beea44</span><span class="token punctuation">,</span> <span class="token number">0x4bdecfa9</span><span class="token punctuation">,</span> <span class="token number">0xf6bb4b60</span><span class="token punctuation">,</span> <span class="token number">0xbebfbc70</span><span class="token punctuation">,</span>
		<span class="token number">0x289b7ec6</span><span class="token punctuation">,</span> <span class="token number">0xeaa127fa</span><span class="token punctuation">,</span> <span class="token number">0xd4ef3085</span><span class="token punctuation">,</span> <span class="token number">0x04881d05</span><span class="token punctuation">,</span>
		<span class="token number">0xd9d4d039</span><span class="token punctuation">,</span> <span class="token number">0xe6db99e5</span><span class="token punctuation">,</span> <span class="token number">0x1fa27cf8</span><span class="token punctuation">,</span> <span class="token number">0xc4ac5665</span><span class="token punctuation">,</span>
		<span class="token number">0xf4292244</span><span class="token punctuation">,</span> <span class="token number">0x432aff97</span><span class="token punctuation">,</span> <span class="token number">0xab9423a7</span><span class="token punctuation">,</span> <span class="token number">0xfc93a039</span><span class="token punctuation">,</span>
		<span class="token number">0x655b59c3</span><span class="token punctuation">,</span> <span class="token number">0x8f0ccc92</span><span class="token punctuation">,</span> <span class="token number">0xffeff47d</span><span class="token punctuation">,</span> <span class="token number">0x85845dd1</span><span class="token punctuation">,</span>
		<span class="token number">0x6fa87e4f</span><span class="token punctuation">,</span> <span class="token number">0xfe2ce6e0</span><span class="token punctuation">,</span> <span class="token number">0xa3014314</span><span class="token punctuation">,</span> <span class="token number">0x4e0811a1</span><span class="token punctuation">,</span>
		<span class="token number">0xf7537e82</span><span class="token punctuation">,</span> <span class="token number">0xbd3af235</span><span class="token punctuation">,</span> <span class="token number">0x2ad7d2bb</span><span class="token punctuation">,</span> <span class="token number">0xeb86d391</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">//四轮循环(GG,FF,HH,II)每轮循环每一步所要位移的位数</span>
	<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> qz<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
	<span class="token punctuation">{</span>
		<span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span>
		<span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span>
		<span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span>
		<span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">21</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">//每一轮所要读取的元素下标</span>
	<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> s<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
	<span class="token punctuation">{</span>
		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>
		<span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span>
		<span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">//循环所需要的变量</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre>
<p>这样我们所需要的一些变量以及数据就初始化完成了，现在开始填充组装数据</p>
<pre><code class="prism language-cpp"><span class="token comment">//N*512+448</span>
	<span class="token comment">//N=(数据长度+64(bit))/512(bit)，长度+8是为了防止数据长度&gt;=56</span>
	<span class="token comment">//任意数据长度+64bit刚好是512倍数，最后+8空出存放数据原始长度的位置</span>
	size_t n_len <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">64</span> <span class="token operator">+</span> <span class="token number">56</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>n_text <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>n_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span>n_text<span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> n_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">memcpy</span><span class="token punctuation">(</span>n_text<span class="token punctuation">,</span> text<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//末尾添加二进制1000 0000</span>
	n_text<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
	<span class="token comment">//追加长度</span>
	<span class="token comment">//注意此处末尾添加的是一个64位的数据！！！</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> len_s<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span>len_s<span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">long</span> temp_len <span class="token operator">=</span> <span class="token number">0x00000000</span><span class="token punctuation">;</span>
	temp_len <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span>len <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//此处注意，只拷贝4个字节数据，因为</span>
	<span class="token comment">//unsigned long只有四个字节</span>
	<span class="token function">memcpy</span><span class="token punctuation">(</span>len_s<span class="token punctuation">,</span> <span class="token operator">&amp;</span>temp_len<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">memcpy</span><span class="token punctuation">(</span>n_text <span class="token operator">+</span> <span class="token punctuation">(</span>n_len<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> len_s<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre>
<p>注意填充二进制10时，至少填充一个1000 0000即0x80，还有填充原数据长度是必须得是八个字节<br>
然后开始将填充组装后的数据分为512bit，然后每512bit再分为4组每组32bit共16字节128bit</p>
<pre><code class="prism language-cpp"><span class="token comment">//每64字节（512位）</span>
	<span class="token comment">//处理一次,因为填充过后的数刚好是64的倍数</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> n_len<span class="token punctuation">;</span> j <span class="token operator">+=</span> <span class="token number">64</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">int</span> H<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token function">memcpy</span><span class="token punctuation">(</span>H<span class="token punctuation">,</span> h<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//分段拷贝内容，以供处理多组数据</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">char</span> temp_text<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token function">memset</span><span class="token punctuation">(</span>temp_text<span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">memcpy</span><span class="token punctuation">(</span>temp_text<span class="token punctuation">,</span> n_text <span class="token operator">+</span> j<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//一共循环64次，分为四组</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">64</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token comment">//四组非线性函数运算，用开关语句来判断是第几组</span>
			<span class="token comment">// 0~16第一组，16~32第二组</span>
			<span class="token comment">//32~48第三组，48~64第四组</span>
			<span class="token keyword">unsigned</span> <span class="token keyword">int</span> R <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> f <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> tmp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>i <span class="token operator">/</span> <span class="token number">16</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
			<span class="token comment">//H[1]=X,H[2]=Y,H[3]=Z</span>
			<span class="token comment">//F(X,Y,Z)</span>
			<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> f <span class="token operator">=</span> <span class="token punctuation">(</span>H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> H<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> H<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token comment">//G(X,Y,Z)</span>
			<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> f <span class="token operator">=</span> <span class="token punctuation">(</span>H<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>H<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span>H<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token comment">//H(X,Y,Z)</span>
			<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> f <span class="token operator">=</span> H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> H<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span> H<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token comment">//I</span>
			<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> f <span class="token operator">=</span> H<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token punctuation">(</span>H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token operator">~</span>H<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">//abcd分别交换位置</span>
			tmp  <span class="token operator">=</span> H<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			H<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> H<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			H<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token comment">//R=(a+?(bcd)+M?+ti),四个字节一运算不是一个字节</span>
			R <span class="token operator">=</span> H<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> f <span class="token operator">+</span> k<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span>temp_text<span class="token punctuation">)</span><span class="token punctuation">[</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//b+((a+?(bcd)+M?+ti)&lt;&lt;s))</span>
			H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">R</span> <span class="token generic class-name"><span class="token operator">&lt;&lt;</span> qz<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>R <span class="token operator">&gt;&gt;</span></span></span> <span class="token punctuation">(</span><span class="token number">32</span> <span class="token operator">-</span> qz<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			H<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//每轮循环结束后，ABCD分别与abcd相加</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> h<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> H<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

</code></pre>
<p>因为最后要以字符串的形式输出，所以还需要将十六进制数转为字符串，并且还要将上面动态申请的内存释放，防止内存泄漏</p>
<pre><code class="prism language-cpp"><span class="token function">free</span><span class="token punctuation">(</span>n_text<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">memcpy</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> h<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//与0xff位与将高位的ff变为00</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		output<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">;</span>
	<span class="token comment">//将十六进制数据打印成字符串</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> SHORT_MD5_LEN<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token function">sprintf</span><span class="token punctuation">(</span>dst <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"%02x"</span><span class="token punctuation">,</span> output<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
</body>

</html>
